<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recent Garden Calculations</title>

  <style>
    /* --- Base --- */
    :root {
      --bg: #ffffff;         /* page background */
      --fg: #111111;         /* body text */
      --bar: #000000;        /* top bar */
      --muted: #4b5563;      /* subtle text */

      /* Buttons: dark by default, green on hover */
      --btn-bg: #0b1224;           /* default (same as before) */
      --btn-fg: #ffffff;
      --btn-b: #111111;
      --btn-hover: #22c55e;        /* green on hover */
      --btn-hover-b: #16a34a;

      --tbl-h: #f3f4f6;      /* table head background */
      --line: #000000;       /* table borders -> BLACK */
    }
    * { box-sizing: border-box; }
    html, body { margin:0; padding:0; }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      line-height: 1.35;
    }

    /* --- Top black bar --- */
    .topbar {
      background: var(--bar);
      color: #ffffff;
      padding: 18px 24px;
      border-bottom: 2px solid var(--line);
    }
    .topbar .wrap {
      max-width: 1100px; margin: 0 auto; display:flex; align-items:center; justify-content:space-between; gap:16px;
    }
    .title { margin: 0; font-size: 28px; font-weight: 800; letter-spacing: .2px; }

    .actions { display:flex; gap:10px; }
    .btn {
      background: var(--btn-bg);
      color: var(--btn-fg);
      border: 1px solid var(--btn-b);
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      text-decoration: none;
      display:inline-block;
      transition: background .12s ease, border-color .12s ease, transform .06s ease, color .12s ease;
    }
    .btn:hover {
      background: var(--btn-hover);
      border-color: var(--btn-hover-b);
      color: #ffffff;
    }
    .btn:active { transform: translateY(1px); }

    /* --- Content --- */
    .shell { max-width: 1100px; margin: 22px auto; padding: 0 24px; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 8px; }

    /* --- Table Card --- */
    .card { background: #ffffff; border: 2px solid var(--line); border-radius: 10px; overflow: hidden; }
    .table-wrap { overflow-x: auto; }

    table { width: 100%; border-collapse: collapse; background: #ffffff; }
    thead th {
      background: var(--tbl-h);
      border-bottom: 2px solid var(--line);
      border-right: 1px solid var(--line);
      padding: 12px 14px; text-align: left; font-size: 12px; text-transform: uppercase; letter-spacing: .08em; color: #111111;
    }
    thead th:last-child { border-right: 0; }

    tbody td {
      padding: 14px; border-bottom: 1px solid var(--line); border-right: 1px solid var(--line);
      font-size: 14px; color: #111111; background: #ffffff;
    }
    tbody tr:last-child td { border-bottom: 0; }
    tbody td:last-child { border-right: 0; }

    .right { text-align: right; }
    .muted { color: var(--muted); }

    .pill {
      display:inline-block; padding: 3px 8px; border-radius: 999px; font-size: 12px;
      background: #ffffff; border: 1px solid var(--line); color: #111111;
    }

    @media (max-width: 640px) { .title { font-size: 22px; } }
  </style>
</head>
<body>

  <!-- Top black header bar -->
  <div class="topbar">
    <div class="wrap">
      <h1 class="title">üå± Last 10 Garden Calculations</h1>
      <div class="actions">
        <button class="btn" id="refresh-btn">Refresh</button>
        <a class="btn" href="./index.html">Home</a>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="shell">
    <div class="card">
      <div class="table-wrap">
        <table id="records-table">
          <thead>
          <tr>
            <th>ID</th>
            <th>Created At</th>
            <th>Growth Choice</th>
            <th>Temp Choice</th>
            <th class="right">Env Count</th>
            <th class="right">Total</th>
            <th>Crop</th>
          </tr>
          </thead>
          <tbody>
          <tr><td colspan="7" class="muted">Loading latest records‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="hint">Tip: This view reads only the last 10 rows. Click ‚ÄúRefresh‚Äù to update.</div>
  </div>

  <!-- Your existing bundle -->
 <script src="assets/js/app.js?v=20250914c"></script>

  <!-- Fallback loader -->
  <script>
    (function () {
      const run = async () => {
        const table = document.getElementById('records-table');
        if (!table) return;
        const tbody = table.querySelector('tbody');

        if (window.loadRecentRecords) { window.loadRecentRecords(); return; }

        tbody.innerHTML = `<tr><td colspan="7" class="muted">Loading latest records‚Ä¶</td></tr>`;
        try {
          const res = await fetch('/api/get-records', { cache: 'no-store' });
          const json = await res.json();
          if (!json.success) throw new Error(json.error || 'Fetch failed');

          tbody.innerHTML = '';
          json.data.forEach(row => {
            const tr = document.createElement('tr');
            const created = new Date(row.created_at);
            tr.innerHTML = `
              <td>${row.id}</td>
              <td class="muted">${created.toLocaleString()}</td>
              <td><span class="pill">${row.growth_choice ?? '-'}</span></td>
              <td><span class="pill">${row.temp_choice ?? '-'}</span></td>
              <td class="right">${Number(row.env_count ?? 0).toLocaleString()}</td>
              <td class="right">${Number(row.total ?? 0).toLocaleString()}</td>
              <td>${row.crop ?? '-'}</td>
            `;
            tbody.appendChild(tr);
          });
          if (!json.data.length) {
            tbody.innerHTML = `<tr><td colspan="7" class="muted">No records yet.</td></tr>`;
          }
        } catch (e) {
          console.error('[records.html fallback] ', e);
          tbody.innerHTML = `<tr><td colspan="7" class="muted">Error: ${e.message}</td></tr>`;
        }
      };
      if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', run); else run();
      document.addEventListener('click', (e) => { if (e.target && e.target.id === 'refresh-btn') run(); });
    })();
  </script>
</body>
</html>

